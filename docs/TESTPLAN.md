# Test Plan for COBOL Account Management App

Purpose: этот тест-план покрывает текущую бизнес-логику приложения (интерактивное меню, операции просмотра баланса, зачисления и списания, и взаимодействие с подпрограммой `DataProgram` из `data.cob`). План пригоден для валидации с бизнес-стейкхолдерами и как основа для последующей миграции тестов в Node.js.

Инструкция по использованию:
- Заполняйте столбцы "Actual Result" и "Status" при выполнении теста.
- Для автоматизированного запуска можно эмулировать ввод в `./accountsystem` с помощью here-doc или скрипта.

Пример неинтерактивного запуска (пример показывает шаги 1 и 4):

```bash
# Пример: посмотреть баланс и выйти
printf "1\n4\n" | ./accountsystem
```

Таблица тест-кейсов

| Test Case ID | Test Case Description | Pre-conditions | Test Steps | Expected Result | Actual Result | Status (Pass/Fail) | Comments |
|---|---|---|---|---|---|---|---|
| TC-01 | Initial balance on fresh start | App compiled; no prior runs that modify in-memory balance (fresh process) | 1) Запустить `./accountsystem` 2) Выбрать `1` (View Balance) | Показать текущий баланс равный 1000.00 (отображение в формате `001000.00` при текущей реализации) | | | Проверить, что значение совпадает с `STORAGE-BALANCE` в `data.cob` (default 1000.00). |
| TC-02 | Credit account (simple deposit) | App running; starting balance known (e.g., 1000.00) | 1) Выбрать `2` (Credit Account) 2) Ввести сумму `500.25` 3) Выбрать `1` (View Balance) | Баланс увеличивается на 500.25 → ожидаемый баланс 1500.25 | | | Если в `operations.cob` есть валидация сумм, она должна пропустить положительную сумму; если запись в WORKING-STORAGE работает — баланс обновлён. |
| TC-03 | Debit account (simple withdrawal, sufficient funds) | App running; баланс >= сумма списания (например 1500.25) | 1) Выбрать `3` (Debit Account) 2) Ввести сумму `200.25` 3) Выбрать `1` (View Balance) | Баланс уменьшается на 200.25 → ожидаемый баланс 1300.00 | | | Проверить что арифметика корректна и формат вывода сохранён. |
| TC-04 | Debit account — insufficient funds (business rule) | App running; баланс меньше запрашиваемой суммы (например баланс 100.00, пытаемся списать 200.00) | 1) Выбрать `3` (Debit Account) 2) Ввести сумму `200.00` | Зависит от бизнес-правила: 1) если запрещён овердрафт — ожидается сообщение об ошибке и баланс не изменится; 2) если допускается отрицательный баланс — баланс обновится до отрицательного значения (текущий код `data.cob` не поддерживает знаковые значения) | | | Важно: текущая `data.cob` использует PIC 9(6)V99 (без знака). Тест показывает, выполняет ли `operations.cob` проверку. Если приложение позволяет отрицательные суммы, это будет баг, если бизнес запрещает овердрафт. |
| TC-05 | Write extreme large balance (overflow) | App running | Попытаться CREDIT/WRITE или прямой вызов на установку баланса > 999999.99 (например 1000000.00) | Ожидается: либо валидация отклоняет значение, либо при записи произойдёт переполнение/ошибка формата. Нормальное поведение — отклонить и показать сообщение об ошибке. | | | `data.cob` формат не поддерживает значение > 999999.99; этот тест выявляет границы PIC. |
| TC-06 | Input negative amount for credit/debit | App running | При выборе Credit/Debit ввести отрицательное число (например `-50.00`) | Ожидается: приложение должно отвергнуть некорректный ввод и не менять баланс; если приложение принимает знак, записать фактическое поведение. | | | Для `data.cob` знак не предусмотрен; проверка должна осуществляться в `operations.cob`/`main.cob`. |
| TC-07 | Non-numeric input for amount | App running | При выборе Credit/Debit ввести `abc` или `100,50` (с запятой) | Ожидается: приложение показывает сообщение об ошибке / запрашивает корректный ввод; не должно сломаться или записать некорректное значение. | | | Проверить устойчивость парсинга ввода. |
| TC-08 | Invalid menu selection | App running | На основном меню ввести `9` или `foo` | Ожидается: приложение показывает сообщение о неверном выборе и возвращается в меню (не падает) | | | Проверить UX и обработку ошибок ввода. |
| TC-09 | Formatting of displayed balance | App running; known balance (e.g., 1000.00) | Выбрать `1` (View Balance) | Баланс отображается с двумя десятичными знаками и при необходимости с ведущими нулями (пример вывода в приложении: `001000.00`) | | | Согласовать с бизнес-стейкхолдерами ожидаемый формат (может потребоваться `1,000.00` или `1000.00`). |
| TC-10 | Persistence between runs | 1) Запустить приложение 2) Выполнить WRITE/изменение баланса 3) Закрыть приложение 4) Запустить снова | По текущей реализации (WORKING-STORAGE): баланс не персистируется между процессами — при новом запуске баланс должен быть 1000.00 | | | Если требуется персистентность, это будет change request. |
| TC-11 | Direct DataProgram contract — READ call (unit-level) | Ability to call `DataProgram` as subprogram or simulate CALL with `PASSED-OPERATION='READ'` и параметром BALANCE | Вызвать DataProgram (или тест-обёртку) с `PASSED-OPERATION='READ'` | Функция возвращает текущее значение `STORAGE-BALANCE` в поле `BALANCE` | | | Полезно для будущей миграции — проверить, что модуль корректно экспортирует интерфейс. |
| TC-12 | Direct DataProgram contract — WRITE call (unit-level) | Ability to call `DataProgram` as subprogram or simulate CALL with `PASSED-OPERATION='WRITE'` и параметром BALANCE | Вызвать DataProgram с `PASSED-OPERATION='WRITE'` и `BALANCE=1234.56`, затем `READ` | После WRITE последующий READ возвращает 1234.56 (в рамках одного процесса) | | | Unit-level проверка корректной работы `PROCEDURE DIVISION USING`. |
| TC-13 | Repeated sequential operations | App running; start from 1000.00 | Выполнить: Credit 100, Credit 200, Debit 50, View Balance | Баланс равен 1250.00 (1000 +100 +200 -50) | | | Проверяет устойчивость при последовательных операциях внутри одного процесса. |
| TC-14 | Input precision (more than 2 decimals) | App running | Попытаться ввести `10.123` в Credit/Debit | Ожидается: либо приложение округляет/усекает до двух десятичных, либо отклоняет ввод; в любом случае должно быть документированное поведение | | | COBOL MOVE в PIC 9(6)V99 тримит/округляет по правилам реализации — тест проверит фактическое поведение. |
| TC-15 | Menu exit behavior | App running | На основном меню выбрать `4` (Exit) | Программа корректно завершает работу с сообщением выхода (например `Exiting the program. Goodbye!`) и возвращает код выхода 0 | | | Проверить корректное завершение и коды возврата при необходимости. |


Notes for stakeholders and for Node.js migration
- Каждый тест описан так, чтобы его можно было автоматизировать при помощи оболочки (запуск процесса и отправка команд на stdin), или в более модульной форме — через unit-тесты к будущему Node.js API (функции getBalance, credit, debit, setBalance, validateTransaction).
- Для миграции в Node.js рекомендую сначала покрыть тестами контракты модулей (DataProgram контракт: read/write balance) — это облегчит перепроверку при переписывании логики.
- Тесты, помеченные как раскрывающие отсутствие валидации (TC-04, TC-06, TC-07, TC-14, TC-05), особенно важны для обсуждения с бизнесом: определить правила (запрет овердрафта? точность/округление? верхние лимиты?).

План готов к утверждению. Заполню столбцы "Actual Result" и "Status" при выполнении каждого теста по вашему запросу или могу сразу создать автоматический набор тестов в Node.js, который будет эмулировать ввод/проверять вывод и наполнять результаты автоматически.
